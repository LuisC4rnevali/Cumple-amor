<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Una Sorpresa para Ti</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Satisfy&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #1a1a1a;
            --primary-color: #f0e6ff;
            --envelope-color: #2c2c2c;
            --envelope-border: #444;
            --letter-color: #f5f5f5;
            --heart-color: #be2edd;
            --font-cursive: "Satisfy", cursive;
            --font-serif: "Playfair Display", serif;
        }

        body {
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            font-family: var(--font-serif);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent; 
            position: relative; /* Necesario para las part√≠culas */
        }

        /* --- NUEVO: Estilos para las part√≠culas de fondo --- */
        .background-particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Para que no interfieran con los clics */
            z-index: 0; /* Asegura que est√©n detr√°s de todo */
            overflow: hidden; /* Oculta part√≠culas que se salgan */
        }
        .particle {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.2); /* Blanco semitransparente */
            border-radius: 50%;
            animation: floatUp 15s infinite linear;
        }

        @keyframes floatUp {
            from {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            25% { opacity: 0.5; }
            75% { opacity: 0.5; }
            to {
                transform: translateY(-100vh) rotate(720deg);
                opacity: 0;
            }
        }
        /* --- FIN NUEVO: Estilos para las part√≠culas de fondo --- */


        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            perspective: 1000px;
            z-index: 1; /* Asegura que el sobre est√© encima de las part√≠culas */
        }

        .envelope-wrapper {
            position: relative;
            cursor: pointer;
        }

        .envelope {
            position: relative;
            width: 300px;
            height: 200px;
            background-color: var(--envelope-color);
            border: 1px solid var(--envelope-border);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.6s ease-in-out;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .envelope-wrapper:hover .envelope {
            transform: translateY(-10px);
        }

        .envelope::before, .envelope::after {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border-style: solid;
            background-color: transparent;
            z-index: 1;
        }

        .envelope::before {
            top: 0;
            left: 0;
            border-width: 100px 150px;
            border-color: var(--envelope-color) transparent transparent var(--envelope-color);
            border-top-color: #333;
        }

        .envelope::after {
            top: 0;
            left: 0;
            border-width: 100px 150px;
            border-color: var(--envelope-border) transparent transparent var(--envelope-border);
            transform-origin: top;
            transition: transform 0.5s 0.3s ease-in-out;
        }
        
        .envelope-wrapper.open .envelope::after {
            transform: rotateX(180deg);
            z-index: -1;
        }

        .letter {
            position: absolute;
            background-color: var(--letter-color);
            width: 280px;
            height: 180px;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            z-index: 0;
            transform: translateY(80px);
            opacity: 0;
            transition: transform 0.5s 0.4s ease-in-out, opacity 0.5s 0.4s;
        }

        .envelope-wrapper.open .letter {
            transform: translateY(-20px);
            opacity: 1;
        }

        .letter .text {
            color: #333;
            font-size: 1.5rem;
            font-family: var(--font-cursive);
        }
        
        .heart {
            position: absolute;
            background-color: var(--heart-color);
            height: 60px;
            width: 60px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -80%) rotate(45deg);
            z-index: 2;
        }
        .heart:before, .heart:after {
            content: "";
            background-color: var(--heart-color);
            border-radius: 50%;
            height: 60px;
            width: 60px;
            position: absolute;
        }
        .heart:before { top: -30px; left: 0; }
        .heart:after { left: -30px; top: 0; }

        .card-container {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            opacity: 0;
            transition: opacity 1s ease-in-out;
            overflow-y: auto;
            padding: 20px;
            box-sizing: border-box;
            flex-direction: column;
            align-items: center;
            z-index: 1; /* Asegura que la carta est√© encima de las part√≠culas */
        }
        
        .card-container.visible { opacity: 1; }

        .card-content {
            max-width: 700px;
            width: 100%;
            text-align: center;
        }

        .photos {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .photo {
            width: 100%;
            aspect-ratio: 1 / 1;
            object-fit: cover;
            border-radius: 15px;
            border: 3px solid var(--primary-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        .photo:hover { transform: scale(1.05); }

        #text-message {
            color: var(--primary-color);
            text-align: left;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin-top: 20px;
            cursor: pointer;
        }
        
        #text-message p {
            font-size: 1.2rem;
            line-height: 1.8;
            margin: 0 0 25px 0;
            min-height: 1.8rem;
        }

        #text-message p em {
            font-style: italic;
            color: #f5b0ff;
        }

        .lightbox {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9);
            justify-content: center; align-items: center; flex-direction: column; 
        }
        .lightbox-content {
            max-width: 90vw; max-height: 80vh; display: none; object-fit: contain; 
        }
        .lightbox-caption {
            color: #fff; font-family: var(--font-cursive); font-size: 1.5rem;
            margin-top: 15px; text-align: center; max-width: 90vw; padding: 0 10px;
        }
        .close-lightbox {
            position: absolute; top: 15px; right: 35px; color: #f1f1f1;
            font-size: 40px; font-weight: bold; transition: 0.3s; cursor: pointer;
        }
        .close-lightbox:hover { color: #bbb; }

        .heart-trail {
            position: absolute; pointer-events: none; z-index: 9999;
            font-size: 2.5rem; animation: fadeOutHeart 0.8s forwards;
            transform: translate(-50%, -50%); 
        }
        @keyframes fadeOutHeart {
            from { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            to { opacity: 0; transform: translate(-50%, -150%) scale(0.5); }
        }
        
        .typing-effect::after {
            content: '‚ñà';
            display: inline-block;
            animation: blink 0.7s infinite;
            margin-left: 4px;
            color: var(--primary-color);
        }
        @keyframes blink {
            0%, 49% { opacity: 1; }
            50%, 100% { opacity: 0; }
        }

        #tap-cue {
            text-align: center;
            color: #999;
            font-family: var(--font-serif);
            font-style: italic;
            margin-top: 20px;
            animation: pulse 2s infinite ease-in-out;
            cursor: pointer; /* PARA HACERLO M√ÅS OBVIO */
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* --- NUEVO: Mensaje final de la carta --- */
        #final-text-cue {
            text-align: center;
            color: #f5b0ff; /* Un color que combine con el √©nfasis del texto */
            font-family: var(--font-cursive); /* O la fuente que prefieras */
            font-size: 1.8rem;
            margin-top: 30px;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 1s 0.5s forwards; /* Aparece despu√©s de que termina el √∫ltimo p√°rrafo */
            pointer-events: none; /* No se puede hacer clic en √©l */
        }
        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

    </style>
</head>
<body>

    <audio id="musicaFondo" loop>
        <source src="musica.mp3" type="audio/mpeg">
        Tu navegador no soporta el elemento de audio.
    </audio>

    <div class="background-particles" id="background-particles"></div>

    <div class="container">
        <div class="envelope-wrapper" id="envelope">
            <div class="envelope">
                <div class="letter">
                    <div class="text">
                        <strong>Toca aqu√≠</strong>
                        <br>
                        üñ§
                    </div>
                </div>
            </div>
            <div class="heart"></div>
        </div>
    </div>

    <div class="card-container" id="card-container">
        <div class="card-content">
            <div class="photos">
                <img src="foto1.jpg" alt="Foto 1" class="photo" data-caption="Me encant√≥ este d√≠a">
                <video src="video1.mp4" class="photo" autoplay loop muted playsinline data-caption="Este d√≠a no voy a olvidar como te quedaste viendo los zocates üòÇ"></video>
                <img src="foto2.jpg" alt="Foto 2" class="photo" data-caption="No lo olvidar√© nunca">
                <video src="video2.mp4" class="photo" autoplay loop muted playsinline data-caption="Nuestra primera salida, mi d√≠a favorito contigo de todos los tiempos, cuando no sab√≠a que eras TAN HERMOSA üòçü•∫"></video>
                <img src="foto3.jpg" alt="Foto 3" class="photo" data-caption="Te amo mucho ü•∫">
            </div>
            <div id="text-message"></div>
            </div>
    </div>

    <div id="lightbox" class="lightbox">
        <span class="close-lightbox" id="close-lightbox">&times;</span>
        <img class="lightbox-content" id="lightbox-img">
        <video class="lightbox-content" id="lightbox-video" controls playsinline></video>
        <div class="lightbox-caption" id="lightbox-caption"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const envelope = document.getElementById('envelope');
            const cardContainer = document.getElementById('card-container');
            const textMessage = document.getElementById('text-message');
            const musica = document.getElementById('musicaFondo');
            const backgroundParticles = document.getElementById('background-particles'); // NUEVO

            const lightbox = document.getElementById('lightbox');
            const lightboxImg = document.getElementById('lightbox-img');
            const lightboxVideo = document.getElementById('lightbox-video');
            const lightboxCaption = document.getElementById('lightbox-caption');
            const closeLightboxBtn = document.getElementById('close-lightbox');
            const mediaItems = document.querySelectorAll('.photo');

            const fullMessage = [
                "Feliz cumplea√±os mi Chilly, Mika, Gaby, Mi amor üñ§ü•∫",
                "Quiero que te queden claras dos cosas: que te amo y que no hay nadie que pueda hacerme sentir como lo haces tu ü´†",
                "S√© que no siempre es f√°cil y que hemos tenido nuestros momentos. Pero quiero que sepas que elijo esto, elijo nuestros desacuerdos y nuestras risas, porque elijo *todo* lo que somos juntos. *Te amo* con una tranquilidad que no necesita de palabras perfectas, solo de hechos y de paciencia.",
                "Conf√≠o en que vas a seguir super√°ndote cada d√≠a como siempre lo haces y que vas a ser la mejor abogado, magistrado, juez de todo el pa√≠s üñ§, que vas a lograr todas y cada una de tus metas en su debido momento, que ser√°s a√∫n m√°s envidiable de lo que actualmente lo eres para todos los que tienen el placer de conocerte. üòç",
                "Conf√≠o en nosotros, conf√≠o en ti, conf√≠o en la vida. Con el tiempo encontraremos nuestra manera perfecta de encajar, sin forzar nada ni darnos momento de incomodidad, eres la mujer que en todo momento me ha hecho sentir que no necesito a nadie m√°s, que me tengo a mi, te tengo a ti y puedo proponerme a todo sin preocuparme de los resultado. ü§©",
                "Te amo cuando estamos de acuerdo y te amo cuando no lo estamos. Eso no cambiara jam√°s. Valoro lo que hemos creado juntos por encima de cualquier dificultad y elijo estar a tu lado todos los d√≠as. ‚ôæÔ∏è",
                "S√© que han habido tensiones, y es algo que no ignoro. Pero te amo demasiado para dejar que eso opaque nuestro futuro. Conf√≠o en nosotros, en que podemos superarnos con paciencia. Supongo que es parte de sentir que eres parte de mi üòÖüòö",
                "Mi mayor deseo para ti es que hoy y siempre te sientas tan amada y fel√≠z como lo mereces. Eres mi amor ü•∫, te necesito solo a ti. üñ§",
                "De tu novio: *\"Blakau\"*, *\"Mapache\"*, *\"Luis\"*, *\"Amargado\"*",
                "*Te amo*."
            ];

            let messageIndex = 0;
            let isEnvelopeOpen = false;
            let isTyping = false;

            // --- NUEVO: Generaci√≥n de part√≠culas de fondo ---
            function createParticles() {
                const numParticles = 30; // N√∫mero de part√≠culas
                for (let i = 0; i < numParticles; i++) {
                    const particle = document.createElement('div');
                    particle.classList.add('particle');
                    const size = Math.random() * 5 + 2; // Tama√±o entre 2px y 7px
                    particle.style.width = `${size}px`;
                    particle.style.height = `${size}px`;
                    particle.style.left = `${Math.random() * 100}vw`; // Posici√≥n horizontal aleatoria
                    particle.style.animationDuration = `${Math.random() * 10 + 10}s`; // Duraci√≥n aleatoria (10-20s)
                    particle.style.animationDelay = `${Math.random() * -15}s`; // Retraso negativo para que aparezcan desde el inicio
                    backgroundParticles.appendChild(particle);
                }
            }
            createParticles(); // Llama a la funci√≥n al cargar la p√°gina

            function openEnvelope() {
                if (isEnvelopeOpen) return;
                isEnvelopeOpen = true;
                musica.play().catch(e => console.log("La reproducci√≥n autom√°tica de m√∫sica fue bloqueada."));
                envelope.classList.add('open');
                // Ajuste de tiempo para una transici√≥n m√°s fluida del sobre a la carta
                setTimeout(() => {
                    envelope.style.display = 'none';
                    cardContainer.style.display = 'flex';
                    cardContainer.classList.add('visible');
                    revealNextMessage();
                }, 1000); // Duraci√≥n de la animaci√≥n del sobre
            }

            function showTapCue() {
                if (document.getElementById('tap-cue')) return;
                const cue = document.createElement('div');
                cue.id = 'tap-cue';
                cue.textContent = 'Toca para continuar...';
                textMessage.appendChild(cue);
            }
            function removeTapCue() {
                const cue = document.getElementById('tap-cue');
                if (cue) cue.remove();
            }
            // --- NUEVO: Funci√≥n para el mensaje final ---
            function showFinalTextCue() {
                if (document.getElementById('final-text-cue')) return;
                const finalCue = document.createElement('div');
                finalCue.id = 'final-text-cue';
                finalCue.innerHTML = 'Vuelve arriba y ve las fotos üëÄ‚òùüèª';
                cardContainer.querySelector('.card-content').appendChild(finalCue); // A√±adir al contenido de la tarjeta
                // Para asegurar que el scroll pueda llegar a verlo
                cardContainer.scrollTop = cardContainer.scrollHeight;
            }


            function typeMessage(element, text, speed = 40) {
                return new Promise(resolve => {
                    let i = 0;
                    let inTag = false;
                    element.innerHTML = '';
                    const intervalId = setInterval(() => {
                        if (i < text.length) {
                            let char = text[i];
                            // Manejo b√°sico de etiquetas <em> para la cursiva
                            if (char === '*') {
                                element.innerHTML += inTag ? '</em>' : '<em>';
                                inTag = !inTag;
                            } else {
                                element.innerHTML += char;
                            }
                            cardContainer.scrollTop = cardContainer.scrollHeight;
                            i++;
                        } else {
                            if (inTag) element.innerHTML += '</em>';
                            clearInterval(intervalId);
                            resolve();
                        }
                    }, speed);
                });
            }

            async function revealNextMessage() {
                if (isTyping) return; // Evitar clics m√∫ltiples mientras se escribe

                if (messageIndex >= fullMessage.length) {
                    showFinalTextCue(); // Muestra el mensaje final si ya no hay m√°s p√°rrafos
                    return; // No hay m√°s mensajes para escribir
                }

                isTyping = true;
                removeTapCue();

                const p = document.createElement('p');
                p.classList.add('typing-effect');
                textMessage.appendChild(p);
                
                await typeMessage(p, fullMessage[messageIndex]);
                
                p.classList.remove('typing-effect');
                messageIndex++;
                isTyping = false;
                
                if (messageIndex < fullMessage.length) {
                    showTapCue();
                } else {
                    showFinalTextCue(); // Muestra el mensaje final despu√©s del √∫ltimo p√°rrafo
                }
            }

            let isDragging = false;
            function createHeart(x, y) {
                const heart = document.createElement('div');
                heart.innerHTML = 'üñ§';
                heart.classList.add('heart-trail');
                heart.style.left = `${x}px`;
                heart.style.top = `${y}px`;
                document.body.appendChild(heart);
                setTimeout(() => { heart.remove(); }, 800);
            }
            
            cardContainer.addEventListener('pointerdown', (e) => {
                // Solo inicia el arrastre si no es sobre un elemento .photo o el lightbox
                if (!e.target.closest('.photo') && !e.target.closest('#lightbox')) {
                    isDragging = true;
                }
            });
            window.addEventListener('pointermove', (e) => { if (isDragging && isEnvelopeOpen) { createHeart(e.clientX, e.clientY); } });
            window.addEventListener('pointerup', () => { isDragging = false; });
            
            envelope.addEventListener('click', openEnvelope);
            
            textMessage.addEventListener('click', revealNextMessage);

            mediaItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.stopPropagation();
                    lightbox.style.display = 'flex';
                    const captionText = item.getAttribute('data-caption');
                    lightboxCaption.textContent = captionText;

                    if (item.tagName === 'IMG') {
                        lightboxImg.src = item.src;
                        lightboxImg.style.display = 'block';
                        lightboxVideo.style.display = 'none';
                        lightboxVideo.pause();
                        lightboxVideo.currentTime = 0;
                    } else if (item.tagName === 'VIDEO') {
                        lightboxVideo.src = item.src;
                        lightboxVideo.style.display = 'block';
                        lightboxVideo.muted = true;
                        lightboxVideo.play().catch(err => console.error("Error:", err));
                        lightboxImg.style.display = 'none';
                    }
                });
            });

            function closeMedia() {
                lightbox.style.display = 'none';
                lightboxVideo.pause();
                lightboxVideo.currentTime = 0;
            }

            closeLightboxBtn.addEventListener('click', closeMedia);
            lightbox.addEventListener('click', (e) => {
                if (e.target === lightbox || e.target === lightboxCaption) {
                    closeMedia();
                }
            });
        });
    </script>

</body>
</html>
